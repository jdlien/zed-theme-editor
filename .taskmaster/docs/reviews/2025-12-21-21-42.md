# Code Review (2025-12-21 21:42)

## High-risk / likely bugs
- `normalizeColorPath` strips `style/accents/`, which will turn valid accents paths like `style/accents/[2]` into `style/[2]` and break selection for actual accents arrays. This also contradicts the normalizeColorPath test expectations. `src/components/JsonEditorPanel.tsx:334`, `src/components/JsonEditorPanel.test.tsx:347`

## Medium-risk / architectural improvements
- JSON swatch path building is O(N) per color match; with dozens/hundreds of colors this becomes O(N^2) per decoration update and can cause lag on larger themes. Consider deriving paths from the CodeMirror syntax tree or a single-pass JSON walker. `src/components/JsonEditorPanel.tsx:145`, `src/components/JsonEditorPanel.tsx:206`, `src/components/JsonEditorPanel.tsx:466`
- Global keyboard shortcuts in `ThemeEditor` override CodeMirrorâ€™s undo/redo once the editor becomes writable, which could cause history conflicts; consider scoping shortcuts to non-editor focus or delegating to CodeMirror when editable. `src/components/ThemeEditor.tsx:105`
- `normalizeColorPath` is exported from a component file and mixes theme-index extraction with path normalization; moving it to a shared lib with a canonical path representation (segments) would reduce future mismatches with `extractColors`. `src/components/JsonEditorPanel.tsx:334`, `src/lib/jsonParsing.ts:180`

## Low-risk / cleanup
- Debug logging left in production paths (color click handler, reducer, decoration updates) will spam console and slow interactions; gate behind a debug flag or remove. `src/components/ThemeEditor.tsx:77`, `src/hooks/useThemeEditor.tsx:134`, `src/components/JsonEditorPanel.tsx:390`

## Open questions / assumptions
- Should `accents` remain a first-class color array (paths like `style/accents/[n]`), or is the intent to flatten it into `style/*`? The current parser and tests treat it as an array, so the path normalization hack likely needs to be removed.
