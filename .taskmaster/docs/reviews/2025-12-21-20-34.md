# Code Review (2025-12-21 20:34)

## High-risk / likely bugs
- JSON editor swatch paths are built as full-document paths (including `themes`) and omit array indices, but updates are applied relative to the active theme. This means clicking a swatch often won’t select or update the correct color, and multi-theme files can’t be edited reliably from the JSON pane. `src/components/JsonEditorPanel.tsx:157`, `src/components/ThemeEditor.tsx:64`, `src/lib/jsonParsing.ts:274`
- CodeMirror edits are not persisted because `handleContentChange` is a no-op, so any state change that updates `serializedTheme` (e.g., changing a color) will overwrite user edits in the JSON editor. This can silently discard manual edits. `src/components/ThemeEditor.tsx:82`, `src/components/JsonEditorPanel.tsx:386`
- External content updates fully replace the CodeMirror document without preserving selection or excluding history, which can reset cursor position and pollute the undo stack whenever `serializedTheme` changes. `src/components/JsonEditorPanel.tsx:386`

## Medium-risk / correctness gaps
- `findColors` only matches `"key": "#hex"` patterns, so colors inside arrays (e.g., `accents`, `players`) and any JSON5 edits with unquoted keys/single quotes will not get swatches. This limits coverage and can mislead users about which colors are editable. `src/components/JsonEditorPanel.tsx:124`
- `buildJsonPath` relies on a simple character scan and does not correctly account for escaped quotes or complex nesting; path output can be wrong even for valid JSON, especially with repeated keys or escaped strings. Consider deriving paths from the CodeMirror syntax tree instead. `src/components/JsonEditorPanel.tsx:157`

## Lower-risk / performance & UX
- Swatch detection re-scans the entire document on every keystroke; for large themes this could get slow. Consider incremental updates or throttling. `src/components/JsonEditorPanel.tsx:304`

## Open questions / assumptions
- Do you want the JSON editor to be authoritative (write-through) or read-only-with-swatch-clicks? The current hybrid approach risks data loss without clear user intent. 
